<h1>Hi guys!</h1>
You can view the raw <a href="/feed">/feed</a>, or play with the UI below.

<h2>Feed</h2>
<braid-feed></braid-feed>

<script src="/js/statebus/statebus.js"></script>
<script src="/js/statebus/client-library.js"></script>
<script type=module>
  import tag from '/tag.js'
  import * as client from '/feed-client.js'
  const $ = tag('braid-feed', { feed: [] })

  client.subscribe_to_feed('/feed', feed => {
    $.teach({ feed })
  })

  $.draw(() => {
    const { feed } = $.learn()
    const form = `
      <form id="new-post">
      <textarea name=subject placeholder=subject></textarea>
      <textarea name=body placeholder=body></textarea>
      <button type=submit>new post</button>
      </form>
    `
    const thread = feed.map(post => `
      <p><a href='${post.url}'><code style='font-size:10'>${post.url}</code></a><br><b>${post.subject || ''}</b><br>${post.body}</p>
    `).join('\n')

    return `
      ${thread}
      ${form}
    `
  })

  $.when('submit', '#new-post', (event) => {
    const { subject, body } = event.target

    client.make_new_post('', {
      subject: subject.value,
      body: body.value
    })

    subject.value = ''
    body.value = ''
  })
</script>
