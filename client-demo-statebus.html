<script type=coffee>
state.feed = []

dom.BODY = ->
  DIV {},
    H1 'Hi guys!'
    'You can view the raw ', A(href: "/feed", '/feed'), ' or play with the UI below.'
    H2 'Feed'
    FEED()

    NEW_POST()
  
FEED = ->
  console.log('rendering feed', state.feed)
  DIV {},
    for post in state.feed
      DIV marginBottom: 10,
        DIV A(href: post.url, CODE({style: fontSize: 10}, post.url))
        DIV B post.subject
        DIV post.body
      
NEW_POST = ->
  DIV {},
    TEXTAREA id: 'subject', placeholder: 'subject'
    TEXTAREA id: 'body', placeholder: 'body'
    INPUT type: 'button', value: 'new post', onClick: -> make_new_post()
</script>

<!-- Include Statebus & Libs -->
<script src="/js/statebus/extras/coffee.js"></script>
<script src="/js/statebus/extras/react12.min.js"></script>
<script src="/js/statebus/statebus.js"></script>
<script src="/js/statebus/client-library.js"></script>

<script type=module>
// Configure Statebus

window.state = bus.state
bus.libs.react12.coffreact()
//bus.libs.http_out('/*', '/')


// Load feed from the network
import * as net from '/net-client.js'

net.subscribe_to_feed('/feed', (feed) => {
  console.log('big guy got the feed', feed)
  state.feed = feed
})

// Make new post
window.make_new_post = () => {
  net.make_new_post('', {
    subject: document.getElementById('subject').value,
    body: document.getElementById('body').value
  })

  // Now clear the form
  document.getElementById('subject').value = ''
  document.getElementById('body').value = ''
}

</script>
