<script type=coffee>
state.feed = []

dom.BODY = ->
  DIV {},

    H1 'Braidmail'
    'You can view the raw ', A(href: "/feed", '/feed'), ' or play with the UI below.'
    H2 'Feed'
    NEW_POST()
    FEED()
  
FEED = ->
  DIV {},
    for post in state.feed
      DIV marginBottom: 5,
        SPAN width: 70, display: 'inline-block',
          A(href: post.url, CODE({style: fontSize: 8}, post.url))
        SPAN paddingRight: 10, B post.subject
        SPAN for p in post.body.split('\n') then [p, BR()]
      
NEW_POST = ->
  DIV {},
    TEXTAREA id: 'subject', placeholder: 'subject'
    TEXTAREA id: 'body', placeholder: 'body'
    INPUT type: 'button', value: 'new post', onClick: -> make_new_post()

threads = ->
  state.feed.slice().reverse()

</script>

<!-- Include Statebus & Libs -->
<script src="/js/statebus/extras/coffee.js"></script>
<script src="/js/statebus/extras/react12.min.js"></script>
<script src="/js/statebus/statebus.js"></script>
<script src="/js/statebus/client-library.js"></script>

<script type=module>
// Configure Statebus

window.state = bus.state
bus.libs.react12.coffreact()
//bus.libs.http_out('/*', '/')


// Load feed from the network
import * as client from '/feed-client.js'

client.subscribe_to_feed('/feed', feed => state.feed = feed)

// Make new post
window.make_new_post = () => {
  client.make_new_post('', {
    subject: document.getElementById('subject').value,
    body: document.getElementById('body').value
  })

  // Now clear the form
  document.getElementById('subject').value = ''
  document.getElementById('body').value = ''
}

</script>
<style>
body, p, input, textarea {
  font-family: avenext, avenir, avenir next, sans;
}
</style>